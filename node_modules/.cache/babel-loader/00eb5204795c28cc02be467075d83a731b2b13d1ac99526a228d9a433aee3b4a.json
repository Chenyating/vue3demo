{"ast":null,"code":"import Clickoutside from 'element-ui/src/utils/clickoutside';\nimport ElSelectMenu from '../src/select-dropdown';\nimport { Tag, Popover } from 'element-ui';\nexport default {\n  // element 的用于判断是否点点击了其他元素\n  directives: {\n    Clickoutside\n  },\n  components: {\n    ElSelectMenu,\n    ElTag: Tag,\n    ElPopover: Popover\n  },\n  props: {\n    // 已选中的标签数据\n    selected: {\n      type: Array,\n      default() {\n        return [];\n      }\n    },\n    filterable: {\n      type: Boolean,\n      default: false\n    },\n    // 弹窗模式下展示更多按钮是否显示数字\n    tagsNumber: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      visible: false,\n      popoverWidth: 0,\n      popperElm: null,\n      referenceEl: null,\n      sizeRecord: {},\n      showIndex: 0,\n      btnFlag: false\n    };\n  },\n  computed: {\n    visible_: {\n      get() {\n        return this.visible && this.selected && this.selected.length > 1;\n      },\n      set(v) {\n        this.visible = v;\n      }\n    },\n    selected_() {\n      return this.selected.slice(0, this.showIndex + 1);\n    },\n    btnFlag_() {\n      return this.selected.length > 1 && this.btnFlag;\n    },\n    style_() {\n      return {\n        maxWidth: this.filterable ? 'calc(100% - 36px)' : '100%'\n      };\n    }\n  },\n  watch: {\n    selected: {\n      immediate: true,\n      handler() {\n        this.$nextTick(() => {\n          this.updataIndex();\n        });\n      }\n    },\n    '$parent.inputWidth'() {\n      this.$nextTick(() => {\n        this.updataIndex();\n      });\n    }\n  },\n  mounted() {\n    // 弹出框宽度\n    this.referenceEl = this.$parent.$refs.reference.$el;\n    this.$nextTick(() => {});\n  },\n  methods: {\n    handleMore() {\n      this.popoverWidth = this.$parent.$el.getBoundingClientRect().width;\n      this.$parent.handleClose();\n      this.visible = !this.visible;\n      this.$nextTick(() => {\n        this.popperElm = this.$refs.popover;\n      });\n    },\n    deleteTag(event, tag) {\n      this.$parent.deleteTag(event, tag);\n      this.$refs.elPopover.updatePopper();\n    },\n    closePopover() {\n      this.visible = false;\n    },\n    updataIndex() {\n      if (!this.selected || this.selected.length <= 1) {\n        this.showIndex = 0;\n        return;\n      }\n      let index = -1;\n      let maxWidth = this.$parent.$refs.tags?.clientWidth || 0;\n      maxWidth = this.filterable ? maxWidth - 36 : maxWidth;\n      let hiddenTags = this.$refs.hiddenTags || [];\n      hiddenTags = [...hiddenTags, this.$refs.hiddenTagsBtn];\n      hiddenTags.forEach((r, i) => {\n        const key = r.$vnode.key;\n        if (!this.sizeRecord[key]) {\n          const e = r.$el;\n          // 获取marginLeft的值\n          const marginLeft = getComputedStyle(e).marginLeft;\n          const width = e.offsetWidth + parseFloat(marginLeft);\n          this.sizeRecord[key] = width;\n        }\n      });\n      const btnWidth = this.sizeRecord['...'];\n      const length = this.selected.length;\n      this.btnFlag = true;\n      this.selected.forEach((v, i) => {\n        const width = this.sizeRecord[v.currentLabel] || 0;\n        maxWidth -= width;\n        if (i === 0) {\n          index++;\n        } else if (maxWidth >= 0 && i === length - 1) {\n          index++;\n          this.btnFlag = false;\n        } else if (maxWidth >= 0 && maxWidth - btnWidth >= 0) {\n          index++;\n        }\n      });\n      this.showIndex = index;\n    }\n  }\n};","map":{"version":3,"names":["Clickoutside","ElSelectMenu","Tag","Popover","directives","components","ElTag","ElPopover","props","selected","type","Array","default","filterable","Boolean","tagsNumber","data","visible","popoverWidth","popperElm","referenceEl","sizeRecord","showIndex","btnFlag","computed","visible_","get","length","set","v","selected_","slice","btnFlag_","style_","maxWidth","watch","immediate","handler","$nextTick","updataIndex","$parent.inputWidth","mounted","$parent","$refs","reference","$el","methods","handleMore","getBoundingClientRect","width","handleClose","popover","deleteTag","event","tag","elPopover","updatePopper","closePopover","index","tags","clientWidth","hiddenTags","hiddenTagsBtn","forEach","r","i","key","$vnode","e","marginLeft","getComputedStyle","offsetWidth","parseFloat","btnWidth","currentLabel"],"sources":["node_modules/@cndinfo/cube-design-web/src/components/Select/src/select-collapse-tags.vue"],"sourcesContent":["<template>\n  <div\n    v-if=\"selected && selected.length > 0\"\n    :style=\"style_\"\n    class=\"select-collapse-popup flexC\"\n  >\n    <!-- 展示的选项和按钮 -->\n    <el-tag\n      v-for=\"(item, i) in selected_\"\n      :key=\"i\"\n      :closable=\"!$parent.selectDisabled\"\n      size=\"small\"\n      type=\"info\"\n      disable-transitions\n      @close=\"deleteTag($event, item)\"\n    >\n      <span class=\"el-select__tags-text\">{{ item.currentLabel }}</span>\n    </el-tag>\n    <el-tag\n      v-if=\"btnFlag_\"\n      ref=\"tagsBtn\"\n      v-clickoutside=\"closePopover\"\n      :closable=\"false\"\n      size=\"small\"\n      type=\"info\"\n      disable-transitions\n      class=\"shrink-0 more-tag pointer\"\n      :class=\"{ active: visible, disabled: $parent.selectDisabled }\"\n      @click.native.stop=\"handleMore\"\n    >\n      <span class=\"el-select__tags-text\">\n        <template\nv-if=\"tagsNumber\"\n          >+ {{ selected.length - showIndex - 1 }}</template\n        >\n        <i v-else class=\"el-icon-more\" style=\"margin-left: 0\" />\n      </span>\n    </el-tag>\n    <!-- 这部分内容用于获取tag的宽度，以下展示的方式和样式要和上面的tag一样（这部分内容是隐藏的） -->\n    <div class=\"collapse-tags-hidden\">\n      <el-tag\n        v-for=\"item in selected\"\n        ref=\"hiddenTags\"\n        :key=\"item.currentLabel\"\n        :closable=\"!$parent.selectDisabled\"\n        size=\"small\"\n        type=\"info\"\n        disable-transitions\n      >\n        <span class=\"el-select__tags-text\">{{ item.currentLabel }}</span>\n      </el-tag>\n      <el-tag\n        ref=\"hiddenTagsBtn\"\n        key=\"...\"\n        :closable=\"false\"\n        size=\"small\"\n        type=\"info\"\n        disable-transitions\n        class=\"shrink-0 more-tag pointer\"\n        :class=\"{ active: visible }\"\n        @click.native.stop=\"handleMore\"\n      >\n        <span class=\"el-select__tags-text\">\n          <template\nv-if=\"tagsNumber\"\n            >+ {{ selected.length - showIndex - 1 }}</template\n          >\n          <i v-else class=\"el-icon-more\" style=\"margin-left: 0\" />\n        </span>\n      </el-tag>\n    </div>\n    <!-- 弹窗 -->\n    <el-popover\n      ref=\"elPopover\"\n      v-model=\"visible_\"\n      placement=\"bottom\"\n      :reference=\"referenceEl\"\n      :width=\"popoverWidth\"\n      :visible-arrow=\"false\"\n      trigger=\"manual\"\n      popper-class=\"cnd-select-popover\"\n    >\n      <div ref=\"popover\" class=\"el-select\">\n        <div class=\"el-select__tags\">\n          <el-tag\n            v-for=\"item in selected\"\n            :key=\"item.currentLabel\"\n            :closable=\"!$parent.selectDisabled\"\n            size=\"small\"\n            type=\"info\"\n            disable-transitions\n            @close=\"deleteTag($event, item)\"\n          >\n            <div class=\"tags-view\">\n              <div class=\"el-select__tags-text\">{{ item.currentLabel }}</div>\n            </div>\n          </el-tag>\n        </div>\n      </div>\n    </el-popover>\n  </div>\n</template>\n\n<script>\nimport Clickoutside from 'element-ui/src/utils/clickoutside'\nimport ElSelectMenu from '../src/select-dropdown'\n\nimport { Tag, Popover } from 'element-ui'\n\nexport default {\n  // element 的用于判断是否点点击了其他元素\n  directives: { Clickoutside },\n  components: { ElSelectMenu, ElTag: Tag, ElPopover: Popover },\n  props: {\n    // 已选中的标签数据\n    selected: {\n      type: Array,\n      default() {\n        return []\n      }\n    },\n    filterable: {\n      type: Boolean,\n      default: false\n    },\n    // 弹窗模式下展示更多按钮是否显示数字\n    tagsNumber: {\n      type: Boolean,\n      default: false\n    }\n  },\n  data() {\n    return {\n      visible: false,\n      popoverWidth: 0,\n      popperElm: null,\n      referenceEl: null,\n      sizeRecord: {},\n      showIndex: 0,\n      btnFlag: false\n    }\n  },\n  computed: {\n    visible_: {\n      get() {\n        return this.visible && this.selected && this.selected.length > 1\n      },\n      set(v) {\n        this.visible = v\n      }\n    },\n    selected_() {\n      return this.selected.slice(0, this.showIndex + 1)\n    },\n    btnFlag_() {\n      return this.selected.length > 1 && this.btnFlag\n    },\n    style_() {\n      return {\n        maxWidth: this.filterable ? 'calc(100% - 36px)' : '100%'\n      }\n    }\n  },\n  watch: {\n    selected: {\n      immediate: true,\n      handler() {\n        this.$nextTick(() => {\n          this.updataIndex()\n        })\n      }\n    },\n    '$parent.inputWidth'() {\n      this.$nextTick(() => {\n        this.updataIndex()\n      })\n    }\n  },\n  mounted() {\n    // 弹出框宽度\n    this.referenceEl = this.$parent.$refs.reference.$el\n    this.$nextTick(() => {})\n  },\n  methods: {\n    handleMore() {\n      this.popoverWidth = this.$parent.$el.getBoundingClientRect().width\n      this.$parent.handleClose()\n      this.visible = !this.visible\n      this.$nextTick(() => {\n        this.popperElm = this.$refs.popover\n      })\n    },\n    deleteTag(event, tag) {\n      this.$parent.deleteTag(event, tag)\n      this.$refs.elPopover.updatePopper()\n    },\n    closePopover() {\n      this.visible = false\n    },\n    updataIndex() {\n      if (!this.selected || this.selected.length <= 1) {\n        this.showIndex = 0\n        return\n      }\n      let index = -1\n      let maxWidth = this.$parent.$refs.tags?.clientWidth || 0\n      maxWidth = this.filterable ? maxWidth - 36 : maxWidth\n      let hiddenTags = this.$refs.hiddenTags || []\n      hiddenTags = [...hiddenTags, this.$refs.hiddenTagsBtn]\n      hiddenTags.forEach((r, i) => {\n        const key = r.$vnode.key\n        if (!this.sizeRecord[key]) {\n          const e = r.$el\n          // 获取marginLeft的值\n          const marginLeft = getComputedStyle(e).marginLeft\n          const width = e.offsetWidth + parseFloat(marginLeft)\n          this.sizeRecord[key] = width\n        }\n      })\n      const btnWidth = this.sizeRecord['...']\n      const length = this.selected.length\n      this.btnFlag = true\n      this.selected.forEach((v, i) => {\n        const width = this.sizeRecord[v.currentLabel] || 0\n        maxWidth -= width\n        if (i === 0) {\n          index++\n        } else if (maxWidth >= 0 && i === length - 1) {\n          index++\n          this.btnFlag = false\n        } else if (maxWidth >= 0 && maxWidth - btnWidth >= 0) {\n          index++\n        }\n      })\n      this.showIndex = index\n    }\n  }\n}\n</script>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}