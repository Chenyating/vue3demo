{"ast":null,"code":"// 主要源代码 (自定义指令)\n// function childNodes(nodes, val) {\n//   nodes.expanded = val\n//   if (nodes.childNodes.length > 0) {\n//     for (var i in nodes.childNodes) {\n//       this.childNodes(nodes.childNodes[i], val)\n//     }\n//   }\n// }\n\nfunction handleContext() {\n  const {\n    contextMenu,\n    binding,\n    vm\n  } = opt;\n  // const { contextMenu, binding, vm, el } = opt\n  const ul = document.createElement('ul');\n  const e = binding.value.e;\n  const target = e.target;\n  //   console.log('binding.value', binding.value)\n  binding.value.menu.map((option, index) => {\n    const li = document.createElement('li');\n    li.innerText = option.text;\n    li.className = 'contextmenu-child';\n    // vm.context是使用了v-contextmenu指令的上下文环境\n    li.onclick = option && option.handler && option.handler.bind(vm && vm.context, li, index, target);\n    ul.appendChild(li);\n  });\n  binding.value.node;\n  contextMenu.appendChild(ul);\n  e.preventDefault();\n\n  // const menuWidth = 100\n  // contextMenu.style.width = `${menuWidth}px`\n  // 动态获取menu高度和宽度\n  const menuHeight = +window.getComputedStyle(contextMenu)['height'].replace(/px/, '');\n  const menuWidth = +window.getComputedStyle(contextMenu)['width'].replace(/px/, '');\n\n  // horizontal\n  if (e.clientX + menuWidth >= window.innerWidth) {\n    contextMenu.style.left = `${e.clientX - menuWidth}px`;\n  } else {\n    contextMenu.style.left = `${e.clientX}px`;\n  }\n  if (e.clientY + menuHeight >= window.innerHeight) {\n    contextMenu.style.top = `${e.clientY - menuHeight}px`;\n  } else {\n    contextMenu.style.top = `${e.clientY}px`;\n  }\n  document.body.appendChild(contextMenu);\n  contextMenu.style.visibility = 'visible';\n  window.addEventListener('click', cb);\n\n  // 判断点击是否在元素外部\n  function cb(e) {\n    const is_inner = contextMenu.contains(e.target);\n    const is_menu_child = e.target.className === 'contextmenu-child';\n    if (!is_inner || is_menu_child) {\n      contextMenu.style.visibility = 'hidden';\n      contextMenu.removeChild(ul);\n      document.body.removeChild(contextMenu);\n      window.removeEventListener('click', cb);\n    }\n  }\n}\nvar opt = {};\nexport default {\n  inserted(ele, el, binding, vm) {\n    const contextMenu = document.createElement('div');\n    // document.body.appendChild(contextMenu)\n    contextMenu.className = 'contextmenu';\n    opt = {\n      contextMenu,\n      el,\n      binding,\n      vm,\n      ele\n    };\n    el.addEventListener('contextmenu', handleContext.bind(opt));\n  },\n  unbind(el, binding) {\n    el.removeEventListener('contextmenu', handleContext.bind(opt));\n  },\n  update(el, binding, vm) {\n    const contextMenu = document.createElement('div');\n    contextMenu.className = 'contextmenu';\n    opt = {\n      contextMenu,\n      el,\n      binding,\n      vm\n    };\n    handleContext();\n    // el.addEventListener('contextmenu', handleContext.bind(opt))\n  }\n};","map":{"version":3,"names":["handleContext","contextMenu","binding","vm","opt","ul","document","createElement","e","value","target","menu","map","option","index","li","innerText","text","className","onclick","handler","bind","context","appendChild","node","preventDefault","menuHeight","window","getComputedStyle","replace","menuWidth","clientX","innerWidth","style","left","clientY","innerHeight","top","body","visibility","addEventListener","cb","is_inner","contains","is_menu_child","removeChild","removeEventListener","inserted","ele","el","unbind","update"],"sources":["/Users/myproject/vuedemo/node_modules/@cndinfo/cube-design-web/src/directives/contextmenu/index.js"],"sourcesContent":["// 主要源代码 (自定义指令)\n// function childNodes(nodes, val) {\n//   nodes.expanded = val\n//   if (nodes.childNodes.length > 0) {\n//     for (var i in nodes.childNodes) {\n//       this.childNodes(nodes.childNodes[i], val)\n//     }\n//   }\n// }\n\nfunction handleContext() {\n  const { contextMenu, binding, vm } = opt\n  // const { contextMenu, binding, vm, el } = opt\n  const ul = document.createElement('ul')\n  const e = binding.value.e\n  const target = e.target\n  //   console.log('binding.value', binding.value)\n  binding.value.menu.map((option, index) => {\n    const li = document.createElement('li')\n    li.innerText = option.text\n    li.className = 'contextmenu-child'\n    // vm.context是使用了v-contextmenu指令的上下文环境\n    li.onclick = option && option.handler && option.handler.bind(vm && vm.context, li, index, target)\n    ul.appendChild(li)\n  })\n  binding.value.node\n  contextMenu.appendChild(ul)\n  e.preventDefault()\n\n  // const menuWidth = 100\n  // contextMenu.style.width = `${menuWidth}px`\n  // 动态获取menu高度和宽度\n  const menuHeight = +window.getComputedStyle(contextMenu)['height'].replace(/px/, '')\n  const menuWidth = +window.getComputedStyle(contextMenu)['width'].replace(/px/, '')\n\n  // horizontal\n  if (e.clientX + menuWidth >= window.innerWidth) {\n    contextMenu.style.left = `${e.clientX - menuWidth}px`\n  } else {\n    contextMenu.style.left = `${e.clientX}px`\n  }\n\n  if (e.clientY + menuHeight >= window.innerHeight) {\n    contextMenu.style.top = `${e.clientY - menuHeight}px`\n  } else {\n    contextMenu.style.top = `${e.clientY}px`\n  }\n\n  document.body.appendChild(contextMenu)\n  contextMenu.style.visibility = 'visible'\n  window.addEventListener('click', cb)\n\n  // 判断点击是否在元素外部\n  function cb(e) {\n    const is_inner = contextMenu.contains(e.target)\n    const is_menu_child = e.target.className === 'contextmenu-child'\n    if (!is_inner || is_menu_child) {\n      contextMenu.style.visibility = 'hidden'\n      contextMenu.removeChild(ul)\n      document.body.removeChild(contextMenu)\n      window.removeEventListener('click', cb)\n    }\n  }\n}\n\nvar opt = {}\n\nexport default {\n  inserted(ele, el, binding, vm) {\n    const contextMenu = document.createElement('div')\n    // document.body.appendChild(contextMenu)\n    contextMenu.className = 'contextmenu'\n\n    opt = { contextMenu, el, binding, vm, ele }\n    el.addEventListener('contextmenu', handleContext.bind(opt))\n  },\n  unbind(el, binding) {\n    el.removeEventListener('contextmenu', handleContext.bind(opt))\n  },\n  update(el, binding, vm) {\n    const contextMenu = document.createElement('div')\n    contextMenu.className = 'contextmenu'\n    opt = { contextMenu, el, binding, vm }\n    handleContext()\n    // el.addEventListener('contextmenu', handleContext.bind(opt))\n  }\n}\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA,SAASA,aAAaA,CAAA,EAAG;EACvB,MAAM;IAAEC,WAAW;IAAEC,OAAO;IAAEC;EAAG,CAAC,GAAGC,GAAG;EACxC;EACA,MAAMC,EAAE,GAAGC,QAAQ,CAACC,aAAa,CAAC,IAAI,CAAC;EACvC,MAAMC,CAAC,GAAGN,OAAO,CAACO,KAAK,CAACD,CAAC;EACzB,MAAME,MAAM,GAAGF,CAAC,CAACE,MAAM;EACvB;EACAR,OAAO,CAACO,KAAK,CAACE,IAAI,CAACC,GAAG,CAAC,CAACC,MAAM,EAAEC,KAAK,KAAK;IACxC,MAAMC,EAAE,GAAGT,QAAQ,CAACC,aAAa,CAAC,IAAI,CAAC;IACvCQ,EAAE,CAACC,SAAS,GAAGH,MAAM,CAACI,IAAI;IAC1BF,EAAE,CAACG,SAAS,GAAG,mBAAmB;IAClC;IACAH,EAAE,CAACI,OAAO,GAAGN,MAAM,IAAIA,MAAM,CAACO,OAAO,IAAIP,MAAM,CAACO,OAAO,CAACC,IAAI,CAAClB,EAAE,IAAIA,EAAE,CAACmB,OAAO,EAAEP,EAAE,EAAED,KAAK,EAAEJ,MAAM,CAAC;IACjGL,EAAE,CAACkB,WAAW,CAACR,EAAE,CAAC;EACpB,CAAC,CAAC;EACFb,OAAO,CAACO,KAAK,CAACe,IAAI;EAClBvB,WAAW,CAACsB,WAAW,CAAClB,EAAE,CAAC;EAC3BG,CAAC,CAACiB,cAAc,CAAC,CAAC;;EAElB;EACA;EACA;EACA,MAAMC,UAAU,GAAG,CAACC,MAAM,CAACC,gBAAgB,CAAC3B,WAAW,CAAC,CAAC,QAAQ,CAAC,CAAC4B,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC;EACpF,MAAMC,SAAS,GAAG,CAACH,MAAM,CAACC,gBAAgB,CAAC3B,WAAW,CAAC,CAAC,OAAO,CAAC,CAAC4B,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC;;EAElF;EACA,IAAIrB,CAAC,CAACuB,OAAO,GAAGD,SAAS,IAAIH,MAAM,CAACK,UAAU,EAAE;IAC9C/B,WAAW,CAACgC,KAAK,CAACC,IAAI,GAAI,GAAE1B,CAAC,CAACuB,OAAO,GAAGD,SAAU,IAAG;EACvD,CAAC,MAAM;IACL7B,WAAW,CAACgC,KAAK,CAACC,IAAI,GAAI,GAAE1B,CAAC,CAACuB,OAAQ,IAAG;EAC3C;EAEA,IAAIvB,CAAC,CAAC2B,OAAO,GAAGT,UAAU,IAAIC,MAAM,CAACS,WAAW,EAAE;IAChDnC,WAAW,CAACgC,KAAK,CAACI,GAAG,GAAI,GAAE7B,CAAC,CAAC2B,OAAO,GAAGT,UAAW,IAAG;EACvD,CAAC,MAAM;IACLzB,WAAW,CAACgC,KAAK,CAACI,GAAG,GAAI,GAAE7B,CAAC,CAAC2B,OAAQ,IAAG;EAC1C;EAEA7B,QAAQ,CAACgC,IAAI,CAACf,WAAW,CAACtB,WAAW,CAAC;EACtCA,WAAW,CAACgC,KAAK,CAACM,UAAU,GAAG,SAAS;EACxCZ,MAAM,CAACa,gBAAgB,CAAC,OAAO,EAAEC,EAAE,CAAC;;EAEpC;EACA,SAASA,EAAEA,CAACjC,CAAC,EAAE;IACb,MAAMkC,QAAQ,GAAGzC,WAAW,CAAC0C,QAAQ,CAACnC,CAAC,CAACE,MAAM,CAAC;IAC/C,MAAMkC,aAAa,GAAGpC,CAAC,CAACE,MAAM,CAACQ,SAAS,KAAK,mBAAmB;IAChE,IAAI,CAACwB,QAAQ,IAAIE,aAAa,EAAE;MAC9B3C,WAAW,CAACgC,KAAK,CAACM,UAAU,GAAG,QAAQ;MACvCtC,WAAW,CAAC4C,WAAW,CAACxC,EAAE,CAAC;MAC3BC,QAAQ,CAACgC,IAAI,CAACO,WAAW,CAAC5C,WAAW,CAAC;MACtC0B,MAAM,CAACmB,mBAAmB,CAAC,OAAO,EAAEL,EAAE,CAAC;IACzC;EACF;AACF;AAEA,IAAIrC,GAAG,GAAG,CAAC,CAAC;AAEZ,eAAe;EACb2C,QAAQA,CAACC,GAAG,EAAEC,EAAE,EAAE/C,OAAO,EAAEC,EAAE,EAAE;IAC7B,MAAMF,WAAW,GAAGK,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC;IACjD;IACAN,WAAW,CAACiB,SAAS,GAAG,aAAa;IAErCd,GAAG,GAAG;MAAEH,WAAW;MAAEgD,EAAE;MAAE/C,OAAO;MAAEC,EAAE;MAAE6C;IAAI,CAAC;IAC3CC,EAAE,CAACT,gBAAgB,CAAC,aAAa,EAAExC,aAAa,CAACqB,IAAI,CAACjB,GAAG,CAAC,CAAC;EAC7D,CAAC;EACD8C,MAAMA,CAACD,EAAE,EAAE/C,OAAO,EAAE;IAClB+C,EAAE,CAACH,mBAAmB,CAAC,aAAa,EAAE9C,aAAa,CAACqB,IAAI,CAACjB,GAAG,CAAC,CAAC;EAChE,CAAC;EACD+C,MAAMA,CAACF,EAAE,EAAE/C,OAAO,EAAEC,EAAE,EAAE;IACtB,MAAMF,WAAW,GAAGK,QAAQ,CAACC,aAAa,CAAC,KAAK,CAAC;IACjDN,WAAW,CAACiB,SAAS,GAAG,aAAa;IACrCd,GAAG,GAAG;MAAEH,WAAW;MAAEgD,EAAE;MAAE/C,OAAO;MAAEC;IAAG,CAAC;IACtCH,aAAa,CAAC,CAAC;IACf;EACF;AACF,CAAC"},"metadata":{},"sourceType":"module","externalDependencies":[]}