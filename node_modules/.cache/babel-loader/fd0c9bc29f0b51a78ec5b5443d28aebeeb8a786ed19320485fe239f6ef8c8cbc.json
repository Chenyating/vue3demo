{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\n// 拉伸\nfunction hasClass(elem, cls) {\n  cls = cls || '';\n  if (cls.replace(/\\s/g, '').length === 0) return false;\n  return new RegExp(` ${cls} `).test(` ${elem.className} `);\n}\nconst resizable = {\n  bind(el, binding) {\n    binding.arg = binding.arg || 'vertical';\n    const handleResizer = typeof binding.value === 'function' ? binding.value : () => {};\n    const getChildren = el => {\n      const childs = el.childNodes || [];\n      const children = [];\n      childs.forEach(child => {\n        if (child.nodeType === 1 && !hasClass(child, 'ide-divider') && child.hasAttribute('weight')) {\n          children.push(child);\n        }\n      });\n      return children;\n    };\n    const createDivider = (el, binding) => {\n      console.log('binding', binding);\n      el.style.position = 'relative';\n      const divider = document.createElement('div');\n      divider.setAttribute('class', `ide-divider ${binding.value}`);\n      el.parentNode.insertBefore(divider, el);\n      // el.appendChild(divider)\n      return divider;\n    };\n    const handleResize = (targetElement, clientX, clientY, index, nextIndex, weights) => {\n      const horizontal = binding.value === 'horizontal';\n      const {\n        left,\n        top\n      } = targetElement.getBoundingClientRect();\n      const {\n        offsetWidth,\n        offsetHeight\n      } = targetElement;\n      const position = horizontal ? clientX - left : clientY - top;\n      const containerSize = horizontal ? offsetWidth : offsetHeight;\n\n      /**\n             * 1.计算总共的比重\n             * 2.计算resize前，当前容器它之前的容器比重之和\n             */\n      let totalWeight = 0;\n      let subtotalWeight = 0;\n      weights.forEach((weight, i) => {\n        totalWeight += weight;\n        if (i < nextIndex) subtotalWeight += weight;\n      });\n\n      /**\n             * 计算resize后的新比重\n             *\n             *   newWeight        position\n             * ———————————— = ————————————————\n             *  totalWeight     containerSize\n             */\n\n      const newWeight = position / containerSize * totalWeight;\n      let deltaWeight = newWeight - subtotalWeight;\n\n      /**\n             * 能调整的最大最小的比重\n             */\n      deltaWeight = Math.max(deltaWeight, -weights[index]);\n      deltaWeight = Math.min(deltaWeight, weights[nextIndex]);\n\n      /**\n             * 前一个容器  +=\n             * 当前容器    -=\n             */\n      weights[index] += deltaWeight;\n      weights[nextIndex] -= deltaWeight;\n      return weights;\n    };\n    let target;\n    const handleMouseDown = e => {\n      target = e.target;\n      e.preventDefault();\n      document.addEventListener('mousemove', handleMouseMove, false);\n      document.addEventListener('mouseup', handleMouseUp, false);\n    };\n    const handleMouseMove = e => {\n      const dx = e.clientX;\n      const dy = e.clientY;\n      const children = getChildren(el);\n      const weights = [];\n      let index = 0;\n      let nextIndex;\n      children.forEach((child, i) => {\n        // const weight = Number(child.getAttribute('weight')) || 1 / children.length\n        const weight = +(child.getAttribute('weight') || 1 / children.length);\n        weights.push(weight);\n        console.log('target', target.parentElement.children[0]);\n        if (target && target.parentElement.children[0] === child) {\n          index = i;\n          nextIndex = i + 1;\n        }\n      });\n      const newWeights = handleResize(el, dx, dy, index, nextIndex, weights);\n      children.forEach((child, i) => {\n        const weight = newWeights[i];\n        child.style.flexGrow = weight;\n        child.setAttribute('weight', weight);\n      });\n      handleResizer(weights);\n    };\n    const handleMouseUp = () => {\n      target = null;\n      document.removeEventListener('mousemove', handleMouseMove);\n      document.removeEventListener('mouseup', handleMouseUp);\n    };\n    const init = () => {\n      if (!el) {\n        return;\n      }\n      const children = getChildren(el);\n      children.forEach((child, index) => {\n        const weight = +(child.getAttribute('weight') || 1 / children.length);\n        child.style.flexGrow = weight;\n        if (index === children.length - 1) {\n          // if (index < children.length - 1) {\n          const divider = createDivider(child, binding);\n          divider.addEventListener('mousedown', handleMouseDown, false);\n        }\n      });\n    };\n    init();\n  }\n};\n\n// eslint-disable-next-line no-undef\nresizable.install = Vue => Vue.directive('resizable', resizer);\nexport default resizable;","map":{"version":3,"names":["hasClass","elem","cls","replace","length","RegExp","test","className","resizable","bind","el","binding","arg","handleResizer","value","getChildren","childs","childNodes","children","forEach","child","nodeType","hasAttribute","push","createDivider","console","log","style","position","divider","document","createElement","setAttribute","parentNode","insertBefore","handleResize","targetElement","clientX","clientY","index","nextIndex","weights","horizontal","left","top","getBoundingClientRect","offsetWidth","offsetHeight","containerSize","totalWeight","subtotalWeight","weight","i","newWeight","deltaWeight","Math","max","min","target","handleMouseDown","e","preventDefault","addEventListener","handleMouseMove","handleMouseUp","dx","dy","getAttribute","parentElement","newWeights","flexGrow","removeEventListener","init","install","Vue","directive","resizer"],"sources":["/Users/myproject/vuedemo/node_modules/@cndinfo/cube-design-web/src/directives/resizable/index.js"],"sourcesContent":["// 拉伸\nfunction hasClass(elem, cls) {\n  cls = cls || ''\n  if (cls.replace(/\\s/g, '').length === 0) return false\n  return new RegExp(` ${cls} `).test(` ${elem.className} `)\n}\n\nconst resizable = {\n  bind(el, binding) {\n    binding.arg = binding.arg || 'vertical'\n\n    const handleResizer = typeof binding.value === 'function' ? binding.value : () => {}\n\n    const getChildren = (el) => {\n      const childs = el.childNodes || []\n      const children = []\n      childs.forEach(child => {\n        if (child.nodeType === 1 && !hasClass(child, 'ide-divider') && child.hasAttribute('weight')) {\n          children.push(child)\n        }\n      })\n      return children\n    }\n\n    const createDivider = (el, binding) => {\n      console.log('binding', binding)\n      el.style.position = 'relative'\n      const divider = document.createElement('div')\n      divider.setAttribute('class', `ide-divider ${binding.value}`)\n      el.parentNode.insertBefore(divider, el)\n      // el.appendChild(divider)\n      return divider\n    }\n\n    const handleResize = (targetElement, clientX, clientY, index, nextIndex, weights) => {\n      const horizontal = binding.value === 'horizontal'\n      const { left, top } = targetElement.getBoundingClientRect()\n      const { offsetWidth, offsetHeight } = targetElement\n      const position = horizontal ? clientX - left : clientY - top\n      const containerSize = horizontal ? offsetWidth : offsetHeight\n\n      /**\n             * 1.计算总共的比重\n             * 2.计算resize前，当前容器它之前的容器比重之和\n             */\n      let totalWeight = 0\n      let subtotalWeight = 0\n\n      weights.forEach((weight, i) => {\n        totalWeight += weight\n\n        if (i < nextIndex) subtotalWeight += weight\n      })\n\n      /**\n             * 计算resize后的新比重\n             *\n             *   newWeight        position\n             * ———————————— = ————————————————\n             *  totalWeight     containerSize\n             */\n\n      const newWeight = (position / containerSize) * totalWeight\n      let deltaWeight = newWeight - subtotalWeight\n\n      /**\n             * 能调整的最大最小的比重\n             */\n      deltaWeight = Math.max(deltaWeight, -weights[index])\n      deltaWeight = Math.min(deltaWeight, weights[nextIndex])\n\n      /**\n             * 前一个容器  +=\n             * 当前容器    -=\n             */\n      weights[index] += deltaWeight\n      weights[nextIndex] -= deltaWeight\n\n      return weights\n    }\n\n    let target\n\n    const handleMouseDown = (e) => {\n      target = e.target\n      e.preventDefault()\n      document.addEventListener('mousemove', handleMouseMove, false)\n      document.addEventListener('mouseup', handleMouseUp, false)\n    }\n\n    const handleMouseMove = (e) => {\n      const dx = e.clientX\n      const dy = e.clientY\n      const children = getChildren(el)\n      const weights = []\n      let index = 0\n      let nextIndex\n      children.forEach((child, i) => {\n        // const weight = Number(child.getAttribute('weight')) || 1 / children.length\n        const weight = +(child.getAttribute('weight') || 1 / children.length)\n        weights.push(weight)\n        console.log('target', target.parentElement.children[0])\n        if (target && target.parentElement.children[0] === child) {\n          index = i\n          nextIndex = i + 1\n        }\n      })\n\n      const newWeights = handleResize(el, dx, dy, index, nextIndex, weights)\n\n      children.forEach((child, i) => {\n        const weight = newWeights[i]\n        child.style.flexGrow = weight\n        child.setAttribute('weight', weight)\n      })\n\n      handleResizer(weights)\n    }\n\n    const handleMouseUp = () => {\n      target = null\n      document.removeEventListener('mousemove', handleMouseMove)\n      document.removeEventListener('mouseup', handleMouseUp)\n    }\n\n    const init = () => {\n      if (!el) {\n        return\n      }\n      const children = getChildren(el)\n\n      children.forEach((child, index) => {\n        const weight = +(child.getAttribute('weight') || (1 / children.length))\n        child.style.flexGrow = weight\n        if (index === children.length - 1) {\n        // if (index < children.length - 1) {\n          const divider = createDivider(child, binding)\n          divider.addEventListener('mousedown', handleMouseDown, false)\n        }\n      })\n    }\n\n    init()\n  }\n}\n\n// eslint-disable-next-line no-undef\nresizable.install = Vue => Vue.directive('resizable', resizer)\n\nexport default resizable\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}